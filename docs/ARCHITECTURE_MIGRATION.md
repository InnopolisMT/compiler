# Миграция архитектуры проекта

## Дата: 12 октября 2025

## Проблемы в старой структуре

### 1. Solution файл в неправильном месте
**Проблема:** `src.sln` находился внутри директории `/src/`
- ❌ Нарушает стандарты .NET проектов
- ❌ Затрудняет работу с несколькими проектами
- ❌ Создает путаницу при работе с IDE

### 2. Solution не включал все проекты
**Проблема:** В solution файле был только проект Compiler, отсутствовал проект tests
- ❌ Невозможно собрать все проекты одной командой
- ❌ IDE не видела связи между проектами
- ❌ Усложнение работы с зависимостями

### 3. Неправильная структура директорий
**Проблема:** Файлы проекта находились непосредственно в `/src/`
- ❌ Не соответствует .NET конвенциям
- ❌ Затрудняет масштабирование проекта
- ❌ Смешение файлов решения и проекта

### 4. Тестовый файл в неправильном месте
**Проблема:** `test.imperative` находился в директории с исходным кодом
- ❌ Смешение кода и примеров
- ❌ Отсутствие централизованного места для примеров

### 5. Неполный .gitignore
**Проблема:** Отсутствовали важные записи для .NET проектов
- ❌ Риск коммита временных файлов
- ❌ Загрязнение репозитория артефактами сборки

## Новая структура

```
compiler/
├── Compiler.sln                    # ✅ Solution в корне
├── .gitignore                      # ✅ Полный .gitignore
├── README.md                       # ✅ Обновленная документация
│
├── src/
│   └── Compiler/                   # ✅ Проект в поддиректории
│       ├── Compiler.csproj
│       ├── Program.cs
│       └── Lexer/
│           ├── LexerClass.cs
│           ├── Token.cs
│           ├── TokenDefinitions.cs
│           └── TokenType.cs
│
├── tests/                          # ✅ Тестовый проект
│   ├── tests.csproj               # ✅ Обновлены пути
│   ├── LexerTests.cs
│   ├── SimpleTestRunner.cs
│   ├── test_files/
│   └── README.md                  # ✅ Новая документация
│
├── examples/                       # ✅ Новая директория для примеров
│   └── test.imperative
│
└── docs/                          # ✅ Документация
    ├── Presentations.md
    ├── Presentations.pdf
    ├── Project I.pdf
    ├── tests.md
    └── ARCHITECTURE_MIGRATION.md  # Этот файл
```

## Выполненные изменения

### 1. Реорганизация структуры директорий
- ✅ Создана директория `/src/Compiler/`
- ✅ Перемещены: `Compiler.csproj`, `Program.cs`, `Lexer/`
- ✅ Создана директория `/examples/`
- ✅ Перемещен `test.imperative` в `/examples/`

### 2. Создание нового Solution файла
- ✅ Создан `Compiler.sln` в корне проекта
- ✅ Добавлены оба проекта: Compiler и tests
- ✅ Настроены конфигурации Debug/Release для обоих проектов
- ✅ Удален старый `src/src.sln`

### 3. Обновление путей в проектных файлах
- ✅ Обновлен путь к Compiler.csproj в tests.csproj:
  - Было: `../src/Compiler.csproj`
  - Стало: `../src/Compiler/Compiler.csproj`

### 4. Обновление .gitignore
- ✅ Добавлены все стандартные записи для .NET проектов
- ✅ Игнорирование bin/, obj/, Debug/, Release/
- ✅ Игнорирование Visual Studio и VS Code файлов
- ✅ Игнорирование NuGet пакетов и кэша
- ✅ Игнорирование системных файлов (.DS_Store)

### 5. Очистка устаревших файлов
- ✅ Удален старый solution файл `src/src.sln`
- ✅ Удалены старые build директории из `/src/`

### 6. Обновление документации
- ✅ Обновлен корневой README.md с новыми командами
- ✅ Создан README.md в директории tests
- ✅ Создан этот документ с описанием миграции

## Преимущества новой структуры

### 1. Соответствие стандартам
- ✅ Следует .NET конвенциям и best practices
- ✅ Совместимость с Visual Studio, Rider, VS Code
- ✅ Соответствие структуре типичных .NET проектов

### 2. Удобство разработки
- ✅ Одна команда для сборки всех проектов: `dotnet build`
- ✅ IDE автоматически распознает структуру
- ✅ Простое добавление новых проектов в будущем

### 3. Масштабируемость
- ✅ Легко добавить новые проекты (Parser, Semantic Analyzer, Code Generator)
- ✅ Четкое разделение между исходным кодом, тестами и примерами
- ✅ Централизованное управление зависимостями

### 4. Чистота репозитория
- ✅ Корректное игнорирование временных файлов
- ✅ Отсутствие артефактов сборки в git
- ✅ Организованная структура примеров и документации

## Проверка после миграции

### Сборка проекта
```bash
$ dotnet build Compiler.sln
Build succeeded.
    0 Warning(s)
    0 Error(s)
```

### Тесты
```bash
$ dotnet test Compiler.sln
Passed!  - Failed: 0, Passed: 23, Skipped: 0, Total: 23
```

✅ Все 23 теста прошли успешно!

## Команды для работы с проектом

### Сборка
```bash
# Собрать весь solution
dotnet build Compiler.sln

# Собрать только компилятор
dotnet build src/Compiler/Compiler.csproj

# Собрать только тесты
dotnet build tests/tests.csproj
```

### Запуск
```bash
# Запустить компилятор
dotnet run --project src/Compiler/Compiler.csproj

# Запустить тесты
dotnet test Compiler.sln
```

### Очистка
```bash
# Очистить все артефакты сборки
dotnet clean Compiler.sln
```

## Заключение

Реорганизация структуры проекта завершена успешно. Новая архитектура:
- ✅ Соответствует стандартам .NET
- ✅ Улучшает удобство разработки
- ✅ Обеспечивает масштабируемость
- ✅ Упрощает работу с проектом

Все тесты пройдены, проект корректно компилируется и готов к дальнейшей разработке.


